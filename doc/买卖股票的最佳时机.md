# 买卖股票的最佳时机

![股票行情分析权威网站，让你轻松掌握投资风云！_大盘分析_龙股网](https://i03piccdn.sogoucdn.com/aa65fae600bc81a4)

## [121]买卖股票的最佳时机

### 题目描述

给定一个数组 `prices` ，它的第 `i` 个元素 `prices[i]` 表示一支给定股票第 `i` 天的价格。

你只能选择 **某一天** 买入这只股票，并选择在 **未来的某一个不同的日子** 卖出该股票。设计一个算法来计算你所能获取的最大利润。

返回你可以从这笔交易中获取的最大利润。如果你不能获取任何利润，返回 `0` 。

### 示例输入

示例 1：

>   **输入：**[7,  1,  5,  3,  6,  4] 
>
>   **输出：**5 
>
>   在第 2 天（股票价格为1）的时候买入，在第 5 天（股票价格为6）的时候卖出，最大利润是 5。
>
>   注意利润不能是 7-1 = 6, 因为卖出价格需要大于买入价格；同时，你不能在买入前卖出股票。

示例 2：

>   **输入：**prices = [7,  6,  4,  3,  1] 
>
>   **输出：**0 
>
>   在这种情况下, 没有交易完成, 所以最大利润为 0。

### 题解

我们使用`minPrice`来记录遇到的最低价格，用`profit`来记录产生的利润。

对数组进行遍历：

+   如果数组的当前元素比`minPrice`小，那么更新`minPrice`；
+   否则计算当前产生的利润是否大于`profit`，是的话就更新`profit`。

```java
public int maxProfit(int[] prices) {
    if (prices.length < 2) return 0;
    int minPrice = Integer.MAX_VALUE;
    int profit = 0;
    for (int price : prices) {
        if (price < minPrice) {
            minPrice = price;
        } else if (price - minPrice > profit) {
            profit = price - minPrice;
        }
    }
    return profit;
}
```

## [122]买卖股票的最佳时机II

### 题目描述

给你一个整数数组 `prices` ，其中 `prices[i]` 表示某支股票第 `i` 天的价格。

在每一天，你可以决定是否购买和/或出售股票。你在任何时候 **最多** 只能持有 **一股** 股票。你也可以先购买，然后在 **同一天** 出售。

返回 *你能获得的 **最大** 利润* 。

### 示例输入

示例 1：

>   **输入**：prices = [7,  1,  5,  3,  6,  4]
>
>   **输出**：7
>
>   在第 2 天（股票价格为 1）的时候买入，第 3 天（股票价格为 5）的时候卖出；然后在第 4 天（股票价格为 3）的时候买入，第 5 天（股票价格为 6）的时候卖出。这样能获得最多的利润 7。

示例 2：

>   **输入：**[1,  2,  3,  4,  5] 
>
>   **输出：**4
>
>   在第 1 天（股票价格为1）的时候买入，在第 5 天（股票价格为 5）的时候卖出，最大利润是 4。
>

示例 3：

>   **输入：**prices = [7,  6,  4,  3,  1] 
>
>   **输出：**0 
>
>   在这种情况下, 没有交易完成, 所以最大利润为 0。

### 题解

这题看着描述复杂，其实很简单，甚至比上一题还要简单。

对数组进行遍历：

判断当前价格是否比上一天的价格高，如果高的话那么就计算利润，加到总利润中；否则的话就继续保留。

```java
public int maxProfit(int[] prices) {
    int profit = 0;
    for (int i = 1; i < prices.length; i++) {
        if (prices[i] > prices[i - 1]) {
            profit += prices[i] - prices[i - 1];
        }
    }
    return profit;
}
```

## [123]买卖股票的最佳时机III

### 题目描述

给定一个数组，它的第 `i` 个元素是一支给定的股票在第 `i` 天的价格。

设计一个算法来计算你所能获取的最大利润。你最多可以完成 **两笔** 交易。

**注意：**你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。

### 示例输入

示例 1：

>   **输入：**prices = [3,  3,  5,  0,  0,  3,  1,  4] 
>
>   **输出：**6 
>
>   在第 4 天（股票价格 = 0）的时候买入，在第 6 天（股票价格 = 3）的时候卖出，这笔交易所能获得利润 = 3-0 = 3 。
>
>   随后，在第 7 天（股票价格 = 1）的时候买入，在第 8 天 （股票价格 = 4）的时候卖出，这笔交易所能获得利润 = 4-1 = 3 。

示例 2：

>   **输入：**prices = [1,  2,  3,  4,  5] 
>
>   **输出：**4 
>
>   在第 1 天（股票价格 = 1）的时候买入，在第 5 天 （股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。

示例 3：

>   **输入：**prices = [7,  6,  4,  3,  1] 
>
>   **输出：**0 
>
>   在这种情况下, 没有交易完成, 所以最大利润为 0。

### 题解

要计算最多进行两笔交易所能获取的最大利润，可以使用动态规划来解决这个问题。

可以遍历数组，通过维护四个变量来跟踪不同状态下的最大利润：

1.  **firstBuy**: 第一次购买后的最大利润（负值，因为我们要记录购买成本）。
2.  **firstSell**: 第一次出售后的最大利润。
3.  **secondBuy**: 第二次购买后的最大利润（负值）。
4.  **secondSell**: 第二次出售后的最大利润。

```java
public int maxProfitIII(int[] prices) {
    int firstBuy = Integer.MIN_VALUE;
    int firstSell = 0;
    int secondBuy = Integer.MIN_VALUE;
    int secondSell = 0;
    for (int price : prices) {
        firstBuy = Math.max(firstBuy, -price);
        firstSell = Math.max(firstSell, firstBuy + price);
        secondBuy = Math.max(secondBuy, firstSell - price);
        secondSell = Math.max(secondSell, secondBuy + price);
    }
    return secondSell;
}
```

